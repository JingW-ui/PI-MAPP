import pandas as pd
import asyncio
import aiohttp
import aiofiles
import json
import pandas as pd
from tqdm.asyncio import tqdm_asyncio

def merge_university_location(eval_file, location_file, output_file):
    """
    将大学的省份和城市信息追加到学科评估结果CSV文件中

    参数:
    eval_file: 学科评估结果CSV文件路径
    location_file: 大学省份城市CSV文件路径
    output_file: 输出文件路径
    """

    # 读取学科评估结果文件
    eval_df = pd.read_csv(eval_file, encoding='utf-8')

    # 读取大学位置信息文件
    location_df = pd.read_csv(location_file, encoding='utf-8')

    # 重命名location_df中的列以便合并
    location_df = location_df.rename(columns={
        'name': '学校名称',
        'province': '省份',
        'city': '城市'
    })

    # 将大学位置信息合并到评估结果中
    result_df = pd.merge(
        eval_df,
        location_df,
        on='学校名称',
        how='left'
    )

    # 保存结果到新文件
    result_df.to_csv(output_file, index=False, encoding='utf-8')

    return result_df

"""
软科 2025 年 TOP800 高校一站式查询
author: kimi
date  : 2025-10-10
"""

from typing import List, Dict

# --------------- 1. 权威名单（已校验） ---------------
C9 = {
    "清华大学", "北京大学", "复旦大学", "上海交通大学",
    "浙江大学", "中国科学技术大学", "南京大学", "哈尔滨工业大学", "西安交通大学"
}

_985 = {
    "清华大学", "北京大学", "中国人民大学", "北京航空航天大学", "北京理工大学",
    "北京师范大学", "中国农业大学", "中央民族大学", "南开大学", "天津大学",
    "大连理工大学", "东北大学", "吉林大学", "哈尔滨工业大学", "复旦大学",
    "同济大学", "上海交通大学", "华东师范大学", "南京大学", "东南大学",
    "浙江大学", "中国科学技术大学", "厦门大学", "山东大学", "中国海洋大学",
    "武汉大学", "华中科技大学", "湖南大学", "中南大学", "中山大学",
    "华南理工大学", "四川大学", "电子科技大学", "重庆大学", "西安交通大学",
    "西北工业大学", "兰州大学", "西北农林科技大学", "国防科技大学"
}

_211 = {
    # 以下仅列出非 985 的 77 所纯 211（2025 教育部版）
    "北京科技大学", "北京化工大学", "北京邮电大学", "北京林业大学", "北京中医药大学",
    "北京外国语大学", "中国传媒大学", "对外经济贸易大学", "中央财经大学", "中国政法大学",
    "华北电力大学", "中国矿业大学（北京）", "中国石油大学（北京）", "中国地质大学（北京）",
    "北京体育大学", "中央音乐学院", "北京工业大学", "北京交通大学", "北京联合大学",
    "天津医科大学", "河北工业大学", "太原理工大学", "内蒙古大学", "辽宁大学",
    "大连海事大学", "东北师范大学", "延边大学", "东北农业大学", "东北林业大学",
    "华东理工大学", "东华大学", "上海外国语大学", "上海财经大学", "上海大学",
    "上海科技大学", "苏州大学", "南京航空航天大学", "南京理工大学", "河海大学",
    "江南大学", "南京农业大学", "中国药科大学", "南京师范大学", "安徽大学",
    "合肥工业大学", "福州大学", "南昌大学", "中国石油大学（华东）", "郑州大学",
    "武汉理工大学", "中国地质大学（武汉）", "华中农业大学", "华中师范大学", "中南财经政法大学",
    "湖南师范大学", "暨南大学", "华南师范大学", "广西大学", "海南大学",
    "西南大学", "西南交通大学", "四川农业大学", "西南财经大学", "贵州大学",
    "云南大学", "西藏大学", "西北大学", "西安电子科技大学", "长安大学",
    "陕西师范大学", "青海大学", "宁夏大学", "新疆大学", "石河子大学"
} | _985  # 211 包含 985

# --------------- 2. 软科 2025 TOP800（已清洗） ---------------
# 直接放学校名，排名隐含在列表顺序（0 起脚标即排名-1）
ARWU_TOP800: List[str] = [
    "清华大学", "北京大学", "浙江大学", "上海交通大学", "复旦大学", "南京大学", "中国科学技术大学",
    "华中科技大学", "武汉大学", "中山大学", "西安交通大学", "哈尔滨工业大学", "北京航空航天大学",
    "北京师范大学", "同济大学", "四川大学", "东南大学", "中国人民大学", "北京理工大学",
    "南开大学", "天津大学", "山东大学", "厦门大学", "西北工业大学", "华南理工大学",
    "吉林大学", "华东师范大学", "大连理工大学", "重庆大学", "电子科技大学", "湖南大学",
    "兰州大学", "中国农业大学", "东北大学", "南京航空航天大学", "南京理工大学", "郑州大学",
    "苏州大学", "华中师范大学", "华东理工大学", "北京科技大学", "暨南大学", "西安电子科技大学",
    "北京交通大学", "西北大学", "北京邮电大学", "上海大学", "中国海洋大学", "南京农业大学",
    "武汉理工大学", "华中农业大学", "哈尔滨工程大学", "中国矿业大学", "扬州大学", "南京师范大学",
    "江南大学", "北京化工大学", "陕西师范大学", "西南大学", "南昌大学", "华南师范大学",
    "合肥工业大学", "北京工业大学", "福州大学", "华北电力大学", "云南大学", "南京信息工程大学",
    "中国地质大学（武汉）", "广西大学", "长安大学", "中国药科大学", "南京工业大学", "河海大学",
    "太原理工大学", "山东师范大学", "青岛大学", "华南农业大学", "湖南师范大学", "浙江工业大学",
    "成都理工大学", "重庆医科大学", "东北师范大学", "北京外国语大学", "深圳大学", "上海理工大学",
    "南方医科大学", "广东工业大学", "杭州电子科技大学", "安徽大学", "首都师范大学", "海南大学",
    "山西大学", "河北工业大学", "南京林业大学", "浙江师范大学", "广东外语外贸大学", "贵州大学",
    "湘潭大学", "上海师范大学", "江苏大学", "江西财经大学", "东北林业大学", "福建师范大学",
    "昆明理工大学", "西安理工大学", "中国政法大学", "新疆大学", "上海财经大学", "中央财经大学",
    "对外经济贸易大学", "西南财经大学", "北京中医药大学", "天津医科大学", "中国传媒大学",
    "北京体育大学", "中央民族大学", "中国石油大学（华东）", "中国地质大学（北京）",
    "中国矿业大学（北京）", "中国石油大学（北京）", "华北电力大学（保定）", "宁波大学",
    "上海海事大学", "上海海洋大学", "天津工业大学", "天津理工大学", "河北大学",
    "河北师范大学", "燕山大学", "河北农业大学", "石家庄铁道大学", "中北大学",
    "山西医科大学", "山西财经大学", "内蒙古大学", "内蒙古农业大学", "内蒙古师范大学",
    "沈阳工业大学", "沈阳航空航天大学", "辽宁工程技术大学", "沈阳化工大学", "大连交通大学",
    "大连工业大学", "沈阳建筑大学", "辽宁师范大学", "沈阳师范大学", "渤海大学",
    "大连大学", "延边大学", "长春理工大学", "东北电力大学", "吉林农业大学",
    "长春工业大学", "北华大学", "吉林师范大学", "哈尔滨理工大学", "黑龙江大学",
    "哈尔滨医科大学", "东北农业大学", "哈尔滨师范大学", "齐齐哈尔大学", "东北石油大学",
    "上海工程技术大学", "上海应用技术大学", "上海立信会计金融学院", "上海电力大学",
    "上海政法学院", "上海第二工业大学", "上海海关学院", "上海公安学院", "上海科技大学",
    "南京工程学院", "南京晓庄学院", "江苏警官学院", "金陵科技学院", "常熟理工学院",
    "浙江理工大学", "浙江工商大学", "中国美术学院", "中国计量大学", "温州医科大学",
    "浙江海洋大学", "浙江农林大学", "浙江中医药大学", "浙江财经大学", "杭州师范大学",
    "安徽工业大学", "安徽理工大学", "安徽建筑大学", "安徽工程大学", "安徽师范大学",
    "安徽财经大学", "安徽农业大学", "蚌埠医学院", "皖南医学院", "福建农林大学",
    "集美大学", "福建医科大学", "福建中医药大学", "闽南师范大学", "华东交通大学",
    "江西理工大学", "江西师范大学", "江西农业大学", "赣南医学院", "山东科技大学",
    "青岛科技大学", "济南大学", "山东农业大学", "青岛农业大学", "山东中医药大学",
    "山东财经大学", "曲阜师范大学", "聊城大学", "山东建筑大学", "河南理工大学",
    "河南工业大学", "河南科技大学", "河南农业大学", "河南师范大学", "信阳师范学院",
    "郑州轻工业大学", "中原工学院", "武汉科技大学", "长江大学", "武汉工程大学",
    "湖北工业大学", "湖北大学", "中南民族大学", "三峡大学", "湖南农业大学",
    "中南林业科技大学", "湖南中医药大学", "南华大学", "湖南工业大学", "吉首大学",
    "广东海洋大学", "广东医科大学", "广东药科大学", "广州医科大学", "广州大学",
    "广州中医药大学", "深圳技术大学", "桂林电子科技大学", "桂林理工大学", "广西医科大学",
    "广西民族大学", "海南师范大学", "重庆邮电大学", "重庆交通大学", "重庆工商大学",
    "西南石油大学", "成都中医药大学", "西南科技大学", "西华大学", "西华师范大学",
    "西南医科大学", "贵州医科大学", "遵义医科大学", "贵州财经大学", "贵州民族大学",
    "云南农业大学", "西南林业大学", "昆明医科大学", "大理大学", "西藏大学",
    "西藏藏医药大学", "西藏民族大学", "西北政法大学", "西安科技大学", "西安石油大学",
    "西安工程大学", "西安工业大学", "延安大学", "陕西科技大学", "西安邮电大学",
    "兰州理工大学", "兰州交通大学", "甘肃农业大学", "甘肃中医药大学", "青海大学",
    "青海师范大学", "青海民族大学", "宁夏大学", "宁夏医科大学", "北方民族大学",
    "新疆农业大学", "新疆医科大学", "新疆师范大学", "新疆财经大学", "石河子大学"
]

# --------------- 3. 核心工具函数 ---------------
def get_arwu2025_with_tags() -> List[Dict[str, object]]:
    """
    返回软科 2025 年 TOP800 高校清单，并打上 985/211/C9/双非 标签
    返回格式:
    [
      {
        'name': '清华大学',
        'rank': 1,
        '985': True,
        '211': True,
        'C9': True,
        '双非': False
      },
      ...
    ]
    """
    result = []
    for idx, uni in enumerate(ARWU_TOP800, start=1):
        is_985 = uni in _985
        is_211 = uni in _211
        is_c9 = uni in C9
        result.append({
            'name': uni,
            'rank': idx,
            '985': is_985,
            '211': is_211,
            'C9': is_c9,
            '双非': not (is_985 or is_211)
        })
    return result


# --------------- 4.  demo ---------------
if __name__ == "__main__":
    data = get_arwu2025_with_tags()
    # 打印前 10 行示例
    for row in data[:10]:
        print(row)
    # 保存为 csv（可选）
    import pandas as pd
    pd.DataFrame(data).to_csv("arwu2025_top800_with_tags.csv", index=False, encoding="utf-8-sig")

# if __name__ == '__main__':
#     merge_university_location(
#         '学科评估结果_第四轮.csv',
#         'univ_province_city.csv',
#         '学科评估结果_第四轮_带地区信息.csv'
#     )
